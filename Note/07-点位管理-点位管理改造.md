# 点位管理之点位管理改造

## 一、搜索框改造

### 1.1.区域 id 改造

将搜索框中的区域 id，改为下拉列表的类型，并查询区域的列表，展示在前端。

查询区域列表的接口如下：

基本信息

Path： /manage/region/list

Method： GET

接口描述：

请求参数

Query

| 参数名称 | 是否必须 | 示例   | 备注     |
| -------- | -------- | ------ | -------- |
| pageNum  | 是       | 1      | 当前页   |
| pageSize | 是       | 10     | 每页个数 |
| name     | 否       | 海淀区 | 区域名称 |

返回数据

| 名称         | 类型      | 是否必须 | 默认值 | 备注     | 其他信息          |
| ------------ | --------- | -------- | ------ | -------- | ----------------- |
| total        | number    | 必须     |        |          | mock: 3           |
| rows         | object [] | 必须     |        |          | item 类型: object |
| ├─ remark    | string    | 必须     |        | 备注说明 |                   |
| ├─ id        | number    | 必须     |        | 区域ID   |                   |
| ├─ name      | string    | 必须     |        | 区域名称 |                   |
| ├─ nodeCount | number    | 必须     |        | 点位数量 |                   |
| code         | number    | 必须     |        |          | mock: 200         |
| msg          | string    | 必须     |        |          | mock: 查询成功    |

找到区域列表的 api 请求，修改其中的参数。

src/api/manage/region.js

```js
// 查询区域管理列表
export function listRegion(query) {
  return request({
    url: '/manage/region/list',
    method: 'get',
    params: query
  })
}
```

将视图组件的“区域 id”改名为“区域搜索”，并将它的文本框类型，改为下拉框：

src/views/manage/node/index.vue

```vue
<el-form-item label="区域 ID" prop="regionId">
  <!-- <el-input
    v-model="queryParams.regionId"
    placeholder="请输入区域 ID"
    clearable
    @keyup.enter="handleQuery"
  /> -->
  <el-select v-model="queryParams.regionId" placeholder="请选择区域" clearable>
    <el-option
      v-for="item of regionOptions"
      :key="item.id"
      :label="item.name"
      :value="item.id"
    />
  </el-select>
</el-form-item>

……

<script>
import { listRegion } from '@/api/manage/region'

/** 查询区域列表 */
const regionOptions = ref([])
function getRegionList() {
  listRegion({ pageNum: 1, pageSize: 10000 }).then(res => {
    regionOptions.value = res.rows
  })
}
  
……
  
getRegionList()
</script>
```

## 二、列表视图改造

### 2.1.加入序号列

src/views/manage/node/index.vue

```vue
<el-table-column label="序号" type="index" align="center" width="50" />
```

## 三、添加或修改对话框改造

### 3.1.区域 Id 改造

将“区域 id”，改名为“所属区域”，并将它从文本框改为下拉列表。

src/views/manage/node/index.vue

```vue
<el-form-item label="所属区域" prop="regionId">
  <!-- <el-input v-model="form.regionId" placeholder="请输入区域 ID" /> -->
  <el-select v-model="form.regionId" placeholder="请选择所属区域" clearable>
    <el-option
      v-for="item of regionOptions"
      :key="item.id"
      :label="item.name"
      :value="item.id"
    />
  </el-select>
</el-form-item>
```

### 3.2.合作商 id 改造

将“合作商 id”，改名为“归属合作商“，并将它从文本框改为下拉框。

src/views/manage/node/index.vue

```vue
<template>
……

  <el-form-item label="归属合作商" prop="partnerId">
    <!-- <el-input v-model="form.partnerId" placeholder="请输入合作商 ID" /> -->
    <el-select v-model="form.partnerId" placeholder="请选择归属合作商" clearable>
      <el-option
        v-for="item in partnerOptions"
        :key="item.id"
        :label="item.name"
        :value="item.id"
      ></el-option>
    </el-select>
  </el-form-item>

……
</template>

<script>
import { listPartner } from '@/api/manage/partner';

/** 查询合作商列表 */
const partnerOptions = ref([])
function getPartnerList() {
  listPartner(loadAllParams).then(res => {
    partnerOptions.value = res.rows
  })
}
  
……

getPartnerList()
</script>
```

