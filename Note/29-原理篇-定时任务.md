# åŽŸç†ç¯‡ä¹‹å®šæ—¶ä»»åŠ¡

åœ¨ Web åº”ç”¨é¡¹ç›®å¼€å‘ä¸­ï¼Œå®šæ—¶ä»»åŠ¡æ˜¯ä¸å¯ç¼ºå°‘çš„ï¼Œ

å®šæ—¶ä»»åŠ¡çš„åœºæ™¯éžå¸¸å¹¿æ³›ï¼Œ

- æ¯”å¦‚ï¼šæŸäº›è§†é¢‘ç½‘ç«™ï¼Œè´­ä¹°ä¼šå‘˜åŽï¼Œæ¯å¤©ä¼šç»™ä¼šå‘˜é€æˆé•¿å€¼ï¼Œæ¯æœˆä¼šç»™ä¼šå‘˜é€ä¸€äº›ç”µå½±åˆ¸ï¼›
- æ¯”å¦‚ï¼šåœ¨ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„åœºæ™¯ä¸­ï¼Œå¾€å¾€åˆ©ç”¨å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼Œè¿›è¡Œä¸€äº›æ¯”å¯¹å·¥ä½œï¼›
- æ¯”å¦‚ä¸€äº›å®šæ—¶éœ€è¦ç”Ÿæˆçš„æŠ¥è¡¨ã€é‚®ä»¶ï¼›
- æ¯”å¦‚ä¸€äº›éœ€è¦å®šæ—¶æ¸…ç†æ•°æ®çš„ä»»åŠ¡
- â€¦â€¦

è‹¥ä¾æä¾›äº†æ–¹ä¾¿å‹å¥½çš„ web ç•Œé¢ï¼Œå¯ä»¥è¾¾åˆ°åŠ¨æ€æŽ§åˆ¶å®šæ—¶ä»»åŠ¡å¯åŠ¨ã€æš‚åœã€é‡å¯ã€åˆ é™¤ã€æ·»åŠ ã€ä¿®æ”¹ç­‰æ“ä½œï¼Œæžå¤§åœ°æ–¹ä¾¿äº†å¼€å‘è¿‡ç¨‹ã€‚

![å®šæ—¶ä»»åŠ¡](NodeAssets/å®šæ—¶ä»»åŠ¡.png)

## ä¸€ã€æ•°æ®åº“è¡¨ç»“æž„è¯´æ˜Ž

sys_job è¡¨ï¼šè¿™æ˜¯æ ¸å¿ƒçš„å®šæ—¶ä»»åŠ¡è¡¨ï¼Œç”¨äºŽå­˜å‚¨å®šæ—¶ä»»åŠ¡çš„é…ç½®ä¿¡æ¯ï¼Œå¦‚ä»»åŠ¡åç§°ã€ä»»åŠ¡ç»„ã€æ‰§è¡Œçš„ç±»å…¨åã€æ‰§è¡Œçš„å‚æ•°ã€cron è¡¨è¾¾å¼ç­‰ã€‚

sys_job_log è¡¨ï¼šç”¨äºŽè®°å½•å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œæ—¥å¿—ï¼ŒåŒ…æ‹¬ä»»åŠ¡çš„å¼€å§‹æ‰§è¡Œæ—¶é—´ã€ç»“æŸæ‰§è¡Œæ—¶é—´ã€æ‰§è¡Œç»“æžœç­‰ã€‚

![å®šæ—¶ä»»åŠ¡æ•°æ®åº“è¡¨ç»“æž„](NodeAssets/å®šæ—¶ä»»åŠ¡æ•°æ®åº“è¡¨ç»“æž„.png)

## äºŒã€é¡¹ç›®ç»“æž„è¯´æ˜Ž

### 2.1.åŽç«¯é¡¹ç›®ç»“æž„

dkd-quartz

```txt
â”œâ”€ðŸ“ src
â”‚â€ƒâ””â”€ðŸ“ main
â”‚â€ƒ  â”œâ”€ðŸ“ java
â”‚â€ƒ  â”‚â€ƒâ””â”€ðŸ“ com
â”‚â€ƒ  â”‚â€ƒ  â””â”€ðŸ“ dkd
â”‚â€ƒ  â”‚â€ƒ    â””â”€ðŸ“ quartz
â”‚â€ƒ  â”‚â€ƒ      â”œâ”€ðŸ“ config-------- # é…ç½®ç±»
â”‚â€ƒ  â”‚â€ƒ      â”œâ”€ðŸ“ controller---- # æŽ§åˆ¶å™¨ç±»
â”‚â€ƒ  â”‚â€ƒ      â”œâ”€ðŸ“ domain-------- # å®žä½“ç±»
â”‚â€ƒ  â”‚â€ƒ      â”œâ”€ðŸ“ mapper-------- # Mapper å±‚
â”‚â€ƒ  â”‚â€ƒ      â”œâ”€ðŸ“ service------- # Service å±‚
â”‚â€ƒ  â”‚â€ƒ      â”œâ”€ðŸ“ task---------- # ä»»åŠ¡ç±»
â”‚â€ƒ  â”‚â€ƒ      â””â”€ðŸ“ util---------- # å·¥å…·ç±»
â”‚â€ƒ  â””â”€ðŸ“ resources
â”œâ”€ðŸ“ target
â””â”€ðŸ“„ pom.xml
```

### 2.1.å‰ç«¯é¡¹ç›®ç»“æž„

```txt
â”œâ”€ðŸ“ bin
â”œâ”€ðŸ“ html
â”œâ”€ðŸ“ public
â”œâ”€ðŸ“ src
â”‚â€ƒâ”œâ”€ðŸ“ api
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ manage
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ monitor
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“„ cache.js
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“„ job.js----------- # APIè¯·æ±‚JSæ–‡ä»¶
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“„ jobLog.js-------- # APIè¯·æ±‚JSæ–‡ä»¶
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“„ logininfor.js
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“„ online.js
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“„ operlog.js
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ””â”€ðŸ“„ server.js
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ system
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ tool
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“„ login.js
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“„ menu.js
â”‚â€ƒâ”‚â€ƒâ””â”€ðŸ“„ page.js
â”‚â€ƒâ”œâ”€ðŸ“ assets
â”‚â€ƒâ”œâ”€ðŸ“ components
â”‚â€ƒâ”œâ”€ðŸ“ directive
â”‚â€ƒâ”œâ”€ðŸ“ layout
â”‚â€ƒâ”œâ”€ðŸ“ plugins
â”‚â€ƒâ”œâ”€ðŸ“ router
â”‚â€ƒâ”œâ”€ðŸ“ store
â”‚â€ƒâ”œâ”€ðŸ“ utils
â”‚â€ƒâ”œâ”€ðŸ“ views
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ error
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ home
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ manage
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ monitor
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ cache
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ druid
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ job
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“„ index.vue------ # è§†å›¾ç»„ä»¶
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ””â”€ðŸ“„ log.vue-------- # è¯•å›¾ç»„ä»¶
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ logininfor
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ online
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ operlog
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ””â”€ðŸ“ server
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ redirect
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ system
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“ tool
â”‚â€ƒâ”‚â€ƒâ”œâ”€ðŸ“„ login.vue
â”‚â€ƒâ”‚â€ƒâ””â”€ðŸ“„ register.vue
â”‚â€ƒâ”œâ”€ðŸ“„ App.vue
â”‚â€ƒâ”œâ”€ðŸ“„ main.js
â”‚â€ƒâ”œâ”€ðŸ“„ permission.js
â”‚â€ƒâ””â”€ðŸ“„ settings.js
â”œâ”€ðŸ“ vite
â”œâ”€ðŸ“„ .env.development
â”œâ”€ðŸ“„ .env.production
â”œâ”€ðŸ“„ .env.staging
â”œâ”€ðŸ“„ .gitignore
â”œâ”€ðŸ“„ index.html
â”œâ”€ðŸ“„ LICENSE
â”œâ”€ðŸ“„ package.json
â”œâ”€ðŸ“„ pnpm-lock.yaml
â”œâ”€ðŸ“„ README.md
â””â”€ðŸ“„ vite.config.js
```

## ä¸‰ã€Quartz ä½“ç³»ç»“æž„

Quartz ä½“ç³»ç»“æž„å¦‚ä¸‹ï¼š

![Quartzä½“ç³»ç»“æž„](NodeAssets/Quartzä½“ç³»ç»“æž„.png)

| API                | æè¿°                                                         |
| ------------------ | ------------------------------------------------------------ |
| **Job**            | å®žé™…è¦æ‰§è¡Œçš„ä»»åŠ¡ç±»ï¼Œå¿…é¡»å®žçŽ° Quartz çš„ `Job` æŽ¥å£ã€‚          |
| **JobDetail**      | ä»£è¡¨ä¸€ä¸ª`Job`å®žä¾‹ï¼Œé€šè¿‡ `JobBuilder` ç±»åˆ›å»ºã€‚                |
| **JobBuilder**     | ç”¨äºŽå£°æ˜Žä¸€ä¸ªä»»åŠ¡å®žä¾‹ï¼Œå¯ä»¥å®šä¹‰å…³äºŽè¯¥ä»»åŠ¡çš„è¯¦æƒ…ï¼Œå¦‚ä»»åŠ¡åã€ç»„åç­‰ã€‚ |
| **Trigger**        | è§¦å‘å™¨ï¼Œç”¨æ¥è§¦å‘å¹¶æ‰§è¡Œ `Job` å®žä¾‹çš„æœºåˆ¶ã€‚                    |
| **SimpleTrigger**  | ç”¨äºŽç®€å•é‡å¤æ‰§è¡Œä½œä¸šçš„è§¦å‘å™¨ï¼Œä¾‹å¦‚ï¼šæ¯éš”ä¸€å®šæ—¶é—´æ‰§è¡Œä¸€æ¬¡ã€‚   |
| **CronTrigger**    | ä½¿ç”¨ Cron è¡¨è¾¾å¼å®šä¹‰æ‰§è¡Œè®¡åˆ’çš„è§¦å‘å™¨ï¼Œé€‚ç”¨äºŽå®šä¹‰å¤æ‚çš„æ‰§è¡Œæ—¶é—´ã€‚ |
| **TriggerBuilder** | ç”¨äºŽåˆ›å»ºè§¦å‘å™¨`Trigger`å®žä¾‹çš„æž„å»ºå™¨ã€‚                        |
| **Scheduler**      | Quartz ä¸­çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£å¯åŠ¨ã€åœæ­¢ã€æš‚åœå’Œæ¢å¤ä»»åŠ¡ã€‚        |

å®šæ—¶ä»»åŠ¡è°ƒç”¨çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š

```mermaid
graph TD
A(åˆå§‹åŒ–SysJobServiceImpl.init) --> B(åˆ›å»ºå®šæ—¶ä»»åŠ¡ScheduleUtils.createScheduleJob)
    B --> C(å¾—åˆ°Jobä»»åŠ¡ç±»AbstractQuartzJob)
    C --> D{æ˜¯å¦å¹¶å‘æ‰§è¡Œ}
    D -->|0| E[QuartzJobExecution]
    D -->|1| F[QuartzDisallowConcurrentExecution]
    E --> G[JobBuilderæž„å»ºJobDetail]
    F --> G
    G --> H[TriggerBuilderæž„å»ºtrigger]
    H --> I[å°†jobDetailå’Œtriggerå­˜å…¥scheduleå®¹å™¨]
    I --> J{åˆ¤æ–­ä»»åŠ¡çŠ¶æ€}
    J -->|1| K[ä½¿ç”¨scheduleæš‚åœä»»åŠ¡]
    J -->|0| L[ä½¿ç”¨scheduleæ‰§è¡Œä»»åŠ¡]
    L --> M[è°ƒç”¨ä»»åŠ¡ç±»æ‰§è¡ŒJobInvokeUtil]
    M --> N[èŽ·å–ç›®æ ‡å¯¹è±¡RyTask]
    N --> O[è°ƒç”¨ä»»åŠ¡æ–¹æ³•ryNoParams]
```
