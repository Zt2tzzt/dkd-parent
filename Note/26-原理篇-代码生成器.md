# åŸç†ç¯‡ä¹‹ä»£ç ç”Ÿæˆå™¨

ä»£ç ç”Ÿæˆå™¨ï¼Œæ˜¯æé«˜å¼€å‘æ•ˆç‡çš„é‡è¦å·¥å…·ï¼Œå®ƒä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š

ç¬¬ä¸€éƒ¨åˆ†ï¼šå°†ä¸šåŠ¡è¡¨ç»“æ„ï¼Œå¯¼å…¥åˆ°ç³»ç»Ÿä¸­ï¼Œåœ¨è¿™é‡Œï¼Œå¼€å‘è€…å¯ä»¥é¢„è§ˆã€ç¼–è¾‘ã€åˆ é™¤å’ŒåŒæ­¥ä¸šåŠ¡è¡¨ç»“æ„ï¼Œå®ç°å¯¹ä¸šåŠ¡è¡¨çš„å…¨é¢ç®¡ç†ã€‚

ç¬¬äºŒéƒ¨åˆ†ï¼šæ˜¯åœ¨é€‰æ‹©äº†ç‰¹å®šçš„è¡¨ä¹‹åï¼Œç‚¹å‡»ç”ŸæˆæŒ‰é’®ï¼Œç³»ç»Ÿå°†æ ¹æ®è¡¨ç»“æ„ï¼Œç”Ÿæˆç›¸åº”çš„å‰åç«¯ä»£ç ï¼Œå¹¶æä¾›ä¸‹è½½ã€‚

![](/Users/zetian/workshop/project/dkd-parent/Note/NodeAssets/ä»£ç ç”Ÿæˆå™¨.png)

## ä¸€ã€æ•°æ®åº“è¡¨ç»“æ„è¯´æ˜

è‹¥ä¾æä¾›äº†ä¸¤å¼ æ ¸å¿ƒè¡¨ï¼Œæ¥å­˜å‚¨å¯¼å…¥çš„ä¸šåŠ¡è¡¨ä¿¡æ¯ï¼š

- `gen_table` è¡¨ï¼šå­˜å‚¨ä¸šåŠ¡è¡¨çš„åŸºæœ¬ä¿¡æ¯ï¼Œå®ƒå¯¹åº”äºé…ç½®ä»£ç â€œåŸºæœ¬ä¿¡æ¯â€å’Œâ€œç”Ÿæˆä¿¡æ¯â€çš„é¡µé¢ï¼›
- `gen_table_column` è¡¨ï¼šå­˜å‚¨ä¸šåŠ¡è¡¨çš„å­—æ®µä¿¡æ¯     å®ƒå¯¹åº”äºé…ç½®ä»£ç â€œå­—æ®µä¿¡æ¯â€çš„é¡µé¢ã€‚

è¿™ä¸¤å¼ è¡¨æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œä¸€å¼ ä¸šåŠ¡è¡¨å¯ä»¥æœ‰å¤šä¸ªå­—æ®µçš„ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨å­—æ®µä¿¡æ¯è¡¨ä¸­æœ‰ä¸ªå¤–é”® `table_id` æŒ‡å‘ä¸šåŠ¡è¡¨ä¸­çš„ `table_id` å­—æ®µ

![](/Users/zetian/workshop/project/dkd-parent/Note/NodeAssets/ä»£ç ç”Ÿæˆå™¨è¡¨ç»“æ„å…³ç³».png)

## äºŒã€é¡¹ç›®ç»“æ„è¯´æ˜

### 2.1.åç«¯é¡¹ç›®è¯´æ˜

dkd-generator

â”œâ”€ğŸ“ src
â”‚â€ƒâ””â”€ğŸ“ main
â”‚â€ƒ  â”œâ”€ğŸ“ java
â”‚â€ƒ  â”‚â€ƒâ””â”€ğŸ“ com
â”‚â€ƒ  â”‚â€ƒ  â””â”€ğŸ“ dkd
â”‚â€ƒ  â”‚â€ƒ    â””â”€ğŸ“ generator
â”‚â€ƒ  â”‚â€ƒ      â”œâ”€ğŸ“ config-------- # è¯»å–ä»£ç ç”Ÿæˆç›¸å…³é…ç½®
â”‚â€ƒ  â”‚â€ƒ      â”œâ”€ğŸ“ controller
â”‚â€ƒ  â”‚â€ƒ      â”œâ”€ğŸ“ domain
â”‚â€ƒ  â”‚â€ƒ      â”œâ”€ğŸ“ mapper
â”‚â€ƒ  â”‚â€ƒ      â”œâ”€ğŸ“ service
â”‚â€ƒ  â”‚â€ƒ      â””â”€ğŸ“ util---------- # Velocity æ¨¡æ¿å·¥å…·ç±»
â”‚â€ƒ  â””â”€ğŸ“ resources
â”‚â€ƒ    â”œâ”€ğŸ“ mapper
â”‚â€ƒ    â”‚â€ƒâ””â”€ğŸ“ generator
â”‚â€ƒ    â”œâ”€ğŸ“ vm
â”‚â€ƒ    â””â”€ğŸ“„ generator.yml

### 2.2.å‰ç«¯é¡¹ç›®ç»“æ„

â”œâ”€ğŸ“ bin
â”œâ”€ğŸ“ html
â”œâ”€ğŸ“ public
â”œâ”€ğŸ“ src
â”‚â€ƒâ”œâ”€ğŸ“ api
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“ manage
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“ monitor
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“ system
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“ tool
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ””â”€ğŸ“„ gen.js----------------- # Api è¯·æ±‚ Js æ–‡ä»¶
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“„ login.js
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“„ menu.js
â”‚â€ƒâ”‚â€ƒâ””â”€ğŸ“„ page.js
â”‚â€ƒâ”œâ”€ğŸ“ assets
â”‚â€ƒâ”œâ”€ğŸ“ components
â”‚â€ƒâ”œâ”€ğŸ“ directive
â”‚â€ƒâ”œâ”€ğŸ“ layout
â”‚â€ƒâ”œâ”€ğŸ“ plugins
â”‚â€ƒâ”œâ”€ğŸ“ router
â”‚â€ƒâ”œâ”€ğŸ“ store
â”‚â€ƒâ”œâ”€ğŸ“ utils
â”‚â€ƒâ”œâ”€ğŸ“ views
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“ error
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“ home
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“ manage
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“ monitor
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“ redirect
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“ system
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“ tool
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“ build
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“ gen
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“„ basicInfoForm.vue---- # åŸºæœ¬ä¿¡æ¯è§†å›¾ç»„ä»¶
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“„ editTable.vue-------- # å­—æ®µä¿¡æ¯è§†å›¾ç»„ä»¶
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“„ genInfoForm.vue------ # ç”Ÿæˆä¿¡æ¯è§†å›¾ç»„ä»¶
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“„ importTable.vue------ # å¯¼å…¥å¯¹è¯æ¡†
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ””â”€ğŸ“„ index.vue------------ # ä»£ç ç”Ÿæˆè§†å›¾ç»„å»º
â”‚â€ƒâ”‚â€ƒâ”‚â€ƒâ””â”€ğŸ“ swagger
â”‚â€ƒâ”‚â€ƒâ”œâ”€ğŸ“„ login.vue
â”‚â€ƒâ”‚â€ƒâ””â”€ğŸ“„ register.vue
â”‚â€ƒâ”œâ”€ğŸ“„ App.vue
â”‚â€ƒâ”œâ”€ğŸ“„ main.js
â”‚â€ƒâ”œâ”€ğŸ“„ permission.js
â”‚â€ƒâ””â”€ğŸ“„ settings.js
â”œâ”€ğŸ“ vite
â”œâ”€â€¦â€¦

## ä¸‰ã€æºç åˆ†æ

### 3.1.å¯¼å…¥è¡¨ç»“æ„

å½“ç®¡ç†å‘˜åœ¨ç•Œé¢ä¸Šç‚¹å‡»å¯¼å…¥æŒ‰é’®æ—¶ï¼Œä¼šå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼›

æ­¤æ—¶ï¼Œå‰ç«¯éœ€è¦å‘åç«¯å‘é€è¯·æ±‚ï¼ŒæŸ¥è¯¢æ•°æ®åº“å¹¶è¿”å›åˆ°å‰ç«¯ï¼Œå±•ç¤ºå½“å‰é¡¹ç›®åº“ä¸­æ‰€æœ‰å¾…å¯¼å…¥çš„ä¸šåŠ¡è¡¨ã€‚

![](/Users/zetian/workshop/project/dkd-parent/Note/NodeAssets/ä»£ç ç”Ÿæˆ-å¯¼å…¥æ•°æ®åº“è¡¨.png)

æ­¤åŠŸèƒ½æ¶‰åŠå‰ç«¯ç›¸å…³çš„ä»£ç ä½äº`views/tool/gen/index.vue`è¿™ä¸ªè§†å›¾ç»„ä»¶ä¸­ï¼Œè´Ÿè´£å®ç°å¯¼å…¥ä¸šåŠ¡è¡¨çš„ç”¨æˆ·ç•Œé¢å’Œäº¤äº’é€»è¾‘ã€‚

src/views/tool/gen/index.vue

```javascript
/** æ‰“å¼€å¯¼å…¥è¡¨å¼¹çª— */
function openImportTable() {
  proxy.$refs["importRef"].show();
}
```

åç«¯å¤„ç†é€»è¾‘ï¼Œåˆ™åœ¨ä»£ç ç”Ÿæˆæ¨¡å—ï¼ˆ`dkd-generator`ï¼‰çš„`GenController`ä¸­ï¼Œè´Ÿè´£æ¥æ”¶å‰ç«¯çš„è¯·æ±‚ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶è¿”å›æŸ¥è¯¢ç»“æœã€‚

dkd-generator/src/main/java/com/dkd/generator/controller/GenController.java

```java
/**
 * æŸ¥è¯¢æ•°æ®åº“åˆ—è¡¨
 */
@PreAuthorize("@ss.hasPermi('tool:gen:list')")
@GetMapping("/db/list")
public TableDataInfo dataList(GenTable genTable) {
    startPage();
    List<GenTable> list = genTableService.selectDbTableList(genTable);
    return getDataTable(list);
}
```

XML è¯­å¥å¦‚ä¸‹ï¼š

dkd-generator/src/main/resources/mapper/generator/GenTableMapper.xml

```xml
<select id="selectDbTableList" parameterType="GenTable" resultMap="GenTableResult">
    <!-- æŸ¥è¯¢æ•°æ®åº“è¡¨åˆ—è¡¨ï¼Œæ’é™¤ç‰¹å®šå‰ç¼€çš„è¡¨ï¼Œå¹¶ä¸”ä¸åœ¨ gen_table ä¸­çš„è¡¨ -->
    select table_name, table_comment, create_time, update_time from information_schema.tables
    where table_schema = (select database())
    AND table_name NOT LIKE 'qrtz_%' AND table_name NOT LIKE 'gen_%'
    AND table_name NOT IN (select table_name from gen_table)
    <if test="tableName != null and tableName != ''">
       <!-- æ ¹æ®è¡¨åæ¨¡ç³ŠæŸ¥è¯¢ -->
       AND lower(table_name) like lower(concat('%', #{tableName}, '%'))
    </if>
    <if test="tableComment != null and tableComment != ''">
       <!-- æ ¹æ®è¡¨æ³¨é‡Šæ¨¡ç³ŠæŸ¥è¯¢ -->
       AND lower(table_comment) like lower(concat('%', #{tableComment}, '%'))
    </if>
    <if test="params.beginTime != null and params.beginTime != ''"><!-- å¼€å§‹æ—¶é—´æ£€ç´¢ -->
       <!-- æ ¹æ®å¼€å§‹æ—¶é—´è¿‡æ»¤è¡¨ -->
       AND date_format(create_time,'%y%m%d') &gt;= date_format(#{params.beginTime},'%y%m%d')
    </if>
    <if test="params.endTime != null and params.endTime != ''"><!-- ç»“æŸæ—¶é—´æ£€ç´¢ -->
       <!-- æ ¹æ®ç»“æŸæ—¶é—´è¿‡æ»¤è¡¨ -->
       AND date_format(create_time,'%y%m%d') &lt;= date_format(#{params.endTime},'%y%m%d')
    </if>
       order by create_time desc
</select>
```

å½“ç®¡ç†å‘˜åœ¨å¯¹è¯æ¡†ä¸­ï¼Œé€‰ä¸­éœ€è¦å¯¼å…¥çš„ä¸šåŠ¡è¡¨ï¼Œç‚¹å‡»ç¡®å®šæŒ‰é’®ï¼Œ

æ­¤æ—¶ï¼Œå‰ç«¯éœ€è¦å‘åç«¯å‘é€è¯·æ±‚ï¼Œä¿å­˜ä¸šåŠ¡è¡¨çš„åŸºæœ¬ä¿¡æ¯å’Œå­—æ®µä¿¡æ¯

æ­¤åŠŸèƒ½ï¼Œæ¶‰åŠå‰ç«¯ç›¸å…³çš„ä»£ç ï¼Œè´Ÿè´£å®ç°å¯¼å…¥ä¸šåŠ¡è¡¨åŠŸèƒ½çš„ç”¨æˆ·ç•Œé¢å’Œäº¤äº’é€»è¾‘ã€‚

src/views/tool/gen/importTable.vue

```javascript
/** å¯¼å…¥æŒ‰é’®æ“ä½œ */
function handleImportTable() {
  const tableNames = tables.value.join(",");
  if (tableNames == "") {
    proxy.$modal.msgError("è¯·é€‰æ‹©è¦å¯¼å…¥çš„è¡¨");
    return;
  }
  importTable({ tables: tableNames }).then(res => {
    proxy.$modal.msgSuccess(res.msg);
    if (res.code === 200) {
      visible.value = false;
      emit("ok");
    }
  });
}
```

åç«¯å¤„ç†é€»è¾‘ï¼Œåˆ™åœ¨ä»£ç ç”Ÿæˆæ¨¡å—çš„`GenController`ä¸­ï¼Œè´Ÿè´£æ¥æ”¶å‰ç«¯çš„è¯·æ±‚ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä¿å­˜ä¸šåŠ¡è¡¨çš„åŸºæœ¬ä¿¡æ¯å’Œå­—æ®µä¿¡æ¯

dkd-generator/src/main/java/com/dkd/generator/controller/GenController.java

```java
/**
 * å¯¼å…¥è¡¨ç»“æ„ï¼ˆä¿å­˜ï¼‰
 */
@PreAuthorize("@ss.hasPermi('tool:gen:import')")
@Log(title = "ä»£ç ç”Ÿæˆ", businessType = BusinessType.IMPORT)
@PostMapping("/importTable")
public AjaxResult importTableSave(String tables) {
    String[] tableNames = Convert.toStrArray(tables);
    // æŸ¥è¯¢è¡¨ä¿¡æ¯
    List<GenTable> tableList = genTableService.selectDbTableListByNames(tableNames);
    // å¯¼å…¥è¡¨ç»“æ„ï¼ˆä¿å­˜ï¼‰
    genTableService.importGenTable(tableList, SecurityUtils.getUsername());
    return success();
}
```

å…·ä½“çš„æ‰§è¡Œçš„æµç¨‹å¦‚ä¸‹å›¾ï¼š

```mermaid
graph TD
A(ç‚¹å‡»ç¡®å®š) --> B[æŸ¥è¯¢è¡¨ç»“æ„]
		B --> C[åˆå§‹åŒ–è¡¨ä¿¡æ¯]
		C --> D[æ’å…¥ä¸šåŠ¡è¡¨]
    D --> E{æ˜¯å¦æ’å…¥æˆåŠŸ}
    E --> |no| F(ç»“æŸ)
    E --> |yes| G[æŸ¥è¯¢è¯¥è¡¨çš„åˆ—ä¿¡æ¯]
    G --> H{æ˜¯å¦æœ‰åˆ—ä¿¡æ¯}
    H --> |no| F
    H --> |yes| I[åˆå§‹åŒ–åˆ—ä¿¡æ¯ï¼Œå…³è”è¡¨]
    I --> J[æ’å…¥åˆ—è¡¨ä¿¡æ¯]
    J --> H
```