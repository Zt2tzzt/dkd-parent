# ç‚¹ä½ç®¡ç†ä¹‹åŒºåŸŸç®¡ç†æ”¹é€ 

## ä¸€ã€ä¸»é”® id label æ”¹é€ 

åœ¨åˆ—è¡¨è§†å›¾é¡µé¢ï¼Œå°†â€ä¸»é”® idâ€œçš„ label æ”¹ä¸ºâ€œåºå·â€ï¼Œå¹¶æä¾›æ’åºçš„åŠŸèƒ½ã€‚

 src/views/manage/region/index.vue

```vue
<el-table-column label="åºå·" type="index" width="50" align="center" prop="id" />
```

- `type="index"` ç”¨äºè®¾ç½®æ’åºåŠŸèƒ½ã€‚
- `width="50"` ç”¨äºå¢åŠ åˆ—çš„å®½åº¦ã€‚

## äºŒã€æ“ä½œåˆ—å›¾æ ‡ç§»é™¤

src/views/manage/region/index.vue

```vue
<el-button link type="primary" icon="Edit" @click="handleUpdate(scope.row)" v-hasPermi="['manage:region:edit']">ä¿®æ”¹</el-button>
<el-button link type="primary" icon="Delete" @click="handleDelete(scope.row)" v-hasPermi="['manage:region:remove']">åˆ é™¤</el-button>

<!-- æ”¹ä¸º ğŸ‘‡ -->

<el-button link type="primary" @click="handleUpdate(scope.row)" v-hasPermi="['manage:region:edit']">ä¿®æ”¹</el-button>
<el-button link type="primary" @click="handleDelete(scope.row)" v-hasPermi="['manage:region:remove']">åˆ é™¤</el-button>
```

- å»æ‰äº† `icon="xxx"` å±æ€§ã€‚

## ä¸‰ã€å¢åŠ â€œç‚¹ä½æ•°â€åˆ—

åœ¨åŒºåŸŸç®¡ç†çš„åˆ—è¡¨è§†å›¾ä¸­ï¼Œå¢åŠ â€œç‚¹ä½æ•°â€åˆ—ã€‚

æ¥å£ä¿¡æ¯å¦‚ä¸‹ï¼š

**Pathï¼š** /manage/region/list

**Methodï¼š** GET

æ¥å£æè¿°ï¼š

è¯·æ±‚å‚æ•°

Query

| å‚æ•°åç§° | æ˜¯å¦å¿…é¡» | ç¤ºä¾‹   | å¤‡æ³¨     |
| -------- | -------- | ------ | -------- |
| pageNum  | æ˜¯       | 1      | å½“å‰é¡µ   |
| pageSize | æ˜¯       | 10     | æ¯é¡µä¸ªæ•° |
| name     | å¦       | æµ·æ·€åŒº | åŒºåŸŸåç§° |

è¿”å›æ•°æ®

| åç§°         | ç±»å‹      | æ˜¯å¦å¿…é¡» | é»˜è®¤å€¼ | å¤‡æ³¨     | å…¶ä»–ä¿¡æ¯          |
| ------------ | --------- | -------- | ------ | -------- | ----------------- |
| total        | number    | å¿…é¡»     |        |          | mock: 3           |
| rows         | object [] | å¿…é¡»     |        |          | item ç±»å‹: object |
| â”œâ”€ remark    | string    | å¿…é¡»     |        | å¤‡æ³¨è¯´æ˜ |                   |
| â”œâ”€ id        | number    | å¿…é¡»     |        | åŒºåŸŸID   |                   |
| â”œâ”€ name      | string    | å¿…é¡»     |        | åŒºåŸŸåç§° |                   |
| â”œâ”€ nodeCount | number    | å¿…é¡»     |        | ç‚¹ä½æ•°é‡ |                   |
| code         | number    | å¿…é¡»     |        |          | mock: 200         |
| msg          | string    | å¿…é¡»     |        |          | mock: æŸ¥è¯¢æˆåŠŸ    |

- å…¶ä¸­åŒ…å«äº† `nodeCount` å­—æ®µï¼Œè¡¨ç¤ºâ€œç‚¹ä½æ•°â€ã€‚

å®ç°ä¸Šæ–¹æ¥å£è¿”å›çš„æ–¹æ¡ˆæœ‰ï¼š

æ–¹æ¡ˆä¸€ï¼š**ï¼ˆ1ï¼‰åŒæ­¥å­˜å‚¨ï¼š**åœ¨åŒºåŸŸè¡¨ `region` ä¸­ï¼Œå­˜å‚¨ç‚¹ä½æ•°çš„å­—æ®µï¼Œå½“ç‚¹ä½å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒåŒæ­¥åŒºåŸŸè¡¨ä¸­çš„ç‚¹ä½æ•°ã€‚

- ä¼˜ç‚¹ï¼šç”±äºæ˜¯å•è¡¨æŸ¥è¯¢æ“ä½œï¼ŒæŸ¥è¯¢åˆ—è¡¨æ•ˆç‡æœ€é«˜ã€‚
- ç¼ºç‚¹ï¼šéœ€è¦åœ¨ç‚¹ä½å¢ã€åˆ ã€æ”¹æ—¶ï¼Œä¿®æ”¹åŒºåŸŸè¡¨ä¸­çš„å­—æ®µå€¼ï¼Œæœ‰é¢å¤–çš„å¼€é”€ï¼Œæ•°æ®ä¹Ÿå¯èƒ½ä¸ä¸€è‡´ã€‚

æ–¹æ¡ˆäºŒï¼š**ï¼ˆ2ï¼‰å…³è”æŸ¥è¯¢ï¼š**ç¼–å†™å…³è”æŸ¥è¯¢è¯­å¥ï¼Œåœ¨ mapper å±‚å°è£…ã€‚

- ä¼˜ç‚¹ï¼šå®æ—¶æŸ¥è¯¢ï¼Œæ•°æ® 100% æ­£ç¡®ï¼Œä¸éœ€è¦å•ç‹¬ç»´æŠ¤ã€‚
- ç¼ºç‚¹ï¼šSQL è¯­å¥è¾ƒå¤æ‚ï¼Œå¦‚æœæ•°æ®é‡å¤§ï¼Œæ€§èƒ½æ¯”è¾ƒä½ã€‚

åŒºåŸŸå’Œç‚¹ä½è¡¨ï¼Œè®°å½•ä¸ªæ•°éƒ½ä¸æ˜¯å¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨å…³è”æŸ¥è¯¢è¿™ç§æ–¹æ¡ˆã€‚

![åŒºåŸŸè¡¨ä¸ç‚¹ä½è¡¨çš„å…³ç³»](NodeAssets/åŒºåŸŸè¡¨ä¸ç‚¹ä½è¡¨çš„å…³ç³».png)

### 3.1.SQL ç¼–å†™

ä¼ ç»Ÿæ–¹å¼ï¼š

```mysql
-- 1.å…ˆèšåˆç»Ÿè®¡æ¯ä¸ªåŒºåŸŸä¸‹çš„ç‚¹ä½
SELECT region_id, COUNT(*) node_count
FROM node
GROUP BY region_id;

-- 2.ç„¶åä¸åŒºåŸŸè¡¨è¿›è¡Œå…³è”æŸ¥è¯¢
SELECT r.name, r.remark, n.node_count
FROM region r
         LEFT JOIN (SELECT region_id, COUNT(*) node_count FROM node GROUP BY region_id) n
                   ON r.id = n.region_id;

-- 3.ä½¿ç”¨ MySQL IFNULL å‡½æ•°ï¼Œå»é™¤æŸ¥è¯¢åˆ°çš„ null å€¼ã€‚
SELECT r.name, r.remark, IFNULL(n.node_count, 0) AS node_count
FROM region r
         LEFT JOIN (SELECT region_id, COUNT(*) node_count FROM node GROUP BY region_id) n
                   ON r.id = n.region_id;
```

- `IFNULL` å‡½æ•°`ï¼Œç”¨äºå¤„ç† null å€¼ã€‚

ä½¿ç”¨ AI ç”Ÿæˆï¼š

Prompt è¾“å…¥ï¼š

```markdown
æŸ¥è¯¢åŒºåŸŸè¡¨æ‰€æœ‰ä¿¡æ¯ï¼Œéœ€è¦æ˜¾ç¤ºæ¯ä¸ªåŒºåŸŸçš„ç‚¹ä½æ•°
```

AIGC è¾“å‡ºï¼š

```mysql
SELECT r.name      AS region_name,
       r.remark,
       COUNT(n.id) AS node_count
FROM region r
         LEFT JOIN
     node n
     ON
         r.id = n.region_id
GROUP BY r.id;
```

### 3.2.åç«¯ VO ç±»è®¾è®¡

åœ¨ domain åŒ…ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªç›®å½• voï¼Œåœ¨å…¶ä¸­åˆ›å»º VO ç±»ã€‚

åˆ›å»º `RegionVO` ç±»ç»§æ‰¿è‡ª `Region` ç±»ï¼Œåœ¨å…¶ä¸­åªéœ€å¢åŠ ä¸€ä¸ªå­—æ®µ `nodeCount`ã€‚

dkd-manage/src/main/java/com/dkd/manage/domain/vo/RegionVO.java

```java
@EqualsAndHashCode(callSuper = true)
@Data
@NoArgsConstructor
@AllArgsConstructor
public class RegionVO extends Region {
    // ç‚¹ä½æ•°é‡
    private Integer nodeCount;
}
```

### 3.3.åç«¯ Mapper å±‚æ”¹é€ 

åœ¨ `RegionMapper` æ¥å£ä¸­ï¼Œæ–°å¢ `selectRegionVOList` æ–¹æ³•ã€‚

dkd-manage/src/main/java/com/dkd/manage/mapper/RegionMapper.java

```java
/**
 * æ­¤æ–¹æ³•ç”¨äºï¼šæŸ¥è¯¢åŒºåŸŸç®¡ç†åˆ—è¡¨
 *
 * @param region åŒºåŸŸç®¡ç†
 * @return List<RegionVO>
 */
List<RegionVO> selectRegionVOList(Region region);
```

åœ¨ XML æ˜ å°„æ–‡ä»¶ä¸­ï¼Œå¤„ç†åŠ¨æ€ SQL

dkd-manage/src/main/resources/mapper/manage/RegionMapper.xml

```xml
    <select id="selectRegionVOList" resultType="com.dkd.manage.domain.vo.RegionVO">
        SELECT r.name,
               r.remark,
               COUNT(n.id) AS node_count
        FROM region r
                 LEFT JOIN
             node n
             ON
                 r.id = n.region_id
        <where>
            <if test="name != null  and name != ''"> AND r.name LIKE concat('%', #{name}, '%')</if>
        </where>
        GROUP BY r.id
    </select>
```

æ³¨æ„äº‹é¡¹ï¼š

- å› ä¸ºä½¿ç”¨äº† PageHelper åˆ†é¡µæŸ¥è¯¢ï¼Œæ‰€æœ‰ SQL è¯­å¥åé¢éƒ½ä¸èƒ½åŠ  `;` å·ã€‚

- ä»æ–‡ä»¶çš„å…¶å®ƒåŠ¨æ€ SQL å¤åˆ¶è¿‡æ¥çš„ `<where>` å­æ ‡ç­¾è¦æ”¾åœ¨ `GROUP BY` è¯­å¥çš„å‰é¢ã€‚å…¶ä¸­è¦å°†è¡¨çš„åˆ«ååŠ ä¸Šï¼›

- `node_count` å­—æ®µï¼Œè¦æ˜ å°„åˆ°ç±»ä¸­çš„ `nodeCount` å­—æ®µï¼Œè¦æ‰“å¼€ MyBatis çš„é©¼å³°å‘½åè½¬æ¢é…ç½®ï¼ˆåœ¨è‹¥ä¾ä¸­é»˜è®¤æ˜¯å…³é—­çš„ï¼‰ï¼š

  dkd-admin/src/main/resources/mybatis/mybatis-config.xml

  ```xml
  <!-- ä½¿ç”¨é©¼å³°å‘½åæ³•è½¬æ¢å­—æ®µ -->
  <setting name="mapUnderscoreToCamelCase" value="true"/>
  ```

### 3.4.åç«¯ Service å±‚æ”¹é€ 

åœ¨ `IRegionService` æ¥å£ä¸­ï¼Œæ–°å¢æ–¹æ³• `regionVoList`ã€‚

dkd-manage/src/main/java/com/dkd/manage/service/.java

```java
/**
 * æ­¤æ–¹æ³•ç”¨äºï¼šæŸ¥è¯¢åŒºåŸŸç®¡ç†åˆ—è¡¨
 *
 * @param region åŒºåŸŸç®¡ç†
 * @return List<RegionVO>
 */
List<RegionVO> regionVoList(Region region);
```

åœ¨ `RegionServiceImpl` å®ç°ç±»ä¸­ï¼Œå®ç° `regionVoList` æ–¹æ³•ã€‚

dkd-manage/src/main/java/com/dkd/manage/service/impl/RegionServiceImpl.java

```java
/**
 * æ­¤æ–¹æ³•ç”¨äºï¼šæŸ¥è¯¢åŒºåŸŸç®¡ç†åˆ—è¡¨
 *
 * @param region åŒºåŸŸç®¡ç†
 * @return List<RegionVO>
 */
@Override
public List<RegionVO> regionVoList(Region region) {
    return regionMapper.selectRegionVOList(region);
}
```

### 3.5.åç«¯ Controller å±‚æ”¹é€ 

`RegionController` æ§åˆ¶å™¨ç±»ä¸­çš„ `list` æ–¹æ³•æ”¹é€ ã€‚

dkd-manage/src/main/java/com/dkd/manage/controller/RegionController.java

```java
/**
 * æŸ¥è¯¢åŒºåŸŸç®¡ç†åˆ—è¡¨
 */
@PreAuthorize("@ss.hasPermi('manage:region:list')")
@GetMapping("/list")
public TableDataInfo list(Region region)
{
    startPage();
    List<RegionVO> list = regionService.regionVoList(region);
    return getDataTable(list);
}
```

> è‹¥ä¾é›†æˆäº†çƒ­æ›´æ–°æ’ä»¶ï¼š
>
> - å¦‚æœæ²¡æœ‰æ–°å¢æ–‡ä»¶ï¼Œä½¿ç”¨å¿«æ·é”® Ctrl + F9ï¼Œå°±å¯ä»¥å®Œæˆåç«¯æœåŠ¡çƒ­æ›´æ–°ã€‚

### 3.6.å‰ç«¯ç»„ä»¶ä¿®æ”¹

åœ¨å‰ç«¯é¡µé¢åŠ å…¥ä¸€åˆ—ï¼Œæ ‡è¯†ç‚¹ä½æ•°ã€‚

src/views/manage/region/index.vue

```vue
<el-table-column label="ç‚¹ä½æ•°" align="center" prop="nodeCount" />
```

## å››ã€æ“ä½œåˆ—å¢åŠ â€œæŸ¥çœ‹è¯¦æƒ…â€

æŸ¥çœ‹è¯¦æƒ…ï¼Œéœ€è¦æ˜¾ç¤ºå½“å‰åŒºåŸŸä¸‹æ‰€æœ‰ç‚¹ä½åˆ—è¡¨ï¼ˆåç»­å®Œæˆï¼‰
